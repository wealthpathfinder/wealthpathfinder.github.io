<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Calculator - Financial Tools</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .calculator-header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .calculator-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .calculator-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .calculator-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .calculator-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.4em;
        }

        .section-title i {
            color: #2d3436;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #2d3436;
        }

        .range-container {
            margin-top: 10px;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .toggle-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .toggle-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-option.active {
            background: #2d3436;
            color: white;
            border-color: #2d3436;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .results-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .tax-summary {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .tax-amount {
            font-size: 3em;
            font-weight: 800;
            margin: 10px 0;
            color: #2d3436;
        }

        .tax-description {
            font-size: 1.2em;
            color: #6c757d;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #2d3436;
        }

        .result-card h3 {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .result-card .value {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
        }

        .chart-container {
            height: 300px;
            margin: 30px 0;
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .breakdown-table th,
        .breakdown-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .breakdown-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .insights-section {
            background: #e8f4fd;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 4px solid #3498db;
        }

        .insights-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-item {
            margin-bottom: 15px;
            padding-left: 20px;
            border-left: 3px solid #2d3436;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .print-btn, .reset-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .print-btn {
            background: #3498db;
            color: white;
        }

        .reset-btn {
            background: #95a5a6;
            color: white;
        }

        .print-btn:hover, .reset-btn:hover {
            transform: translateY(-2px);
        }

        .bracket-section {
            margin-top: 30px;
        }

        .bracket-chart {
            height: 250px;
            margin-top: 20px;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid #2d3436;
            font-weight: 600;
            color: #2d3436;
        }

        .tab-content {
            padding: 20px 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .milestone-section {
            margin-top: 30px;
        }

        .milestone-list {
            margin-top: 15px;
        }

        .milestone-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .milestone-year {
            font-weight: 600;
            color: #2c3e50;
        }

        .milestone-value {
            font-weight: 600;
            color: #2d3436;
        }

        .deduction-section {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }

        .comparison-section {
            margin-top: 30px;
        }

        .comparison-chart {
            height: 250px;
            margin-top: 20px;
        }

        .tax-bracket {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .bracket-range {
            font-weight: 600;
            color: #2c3e50;
        }

        .bracket-rate {
            font-weight: 600;
            color: #2d3436;
        }

        .bracket-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            flex: 1;
            margin: 0 15px;
            overflow: hidden;
        }

        .bracket-fill {
            height: 100%;
            background: #2d3436;
            border-radius: 5px;
        }

        .withholding-section {
            margin-top: 30px;
        }

        .refund-alert {
            background: #d1f7c4;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2ecc71;
        }

        .payment-alert {
            background: #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #fdcb6e;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>Tax Calculator</h1>
            <p>Estimate your tax liability and explore tax-saving strategies</p>
        </div>

        <div class="calculator-content">
            <div class="input-section">
                <div class="section-title">
                    <i class="fas fa-user"></i>
                    <h2>Personal Information</h2>
                </div>
                
                <div class="input-group">
                    <label for="filing-status">Filing Status</label>
                    <select id="filing-status">
                        <option value="single">Single</option>
                        <option value="married_joint">Married Filing Jointly</option>
                        <option value="married_separate">Married Filing Separately</option>
                        <option value="head_household">Head of Household</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tax-year">Tax Year</label>
                    <select id="tax-year">
                        <option value="2023">2023</option>
                        <option value="2024" selected>2024</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="age">Your Age</label>
                    <input type="number" id="age" value="35" min="18" max="120">
                </div>

                <div class="section-title" style="margin-top: 30px;">
                    <i class="fas fa-money-bill-wave"></i>
                    <h2>Income Sources</h2>
                </div>

                <div class="input-group">
                    <label for="wages">Wages, Salaries, Tips ($)</label>
                    <input type="number" id="wages" value="75000" min="0" step="1000">
                </div>

                <div class="input-group">
                    <label for="interest-income">Interest Income ($)</label>
                    <input type="number" id="interest-income" value="500" min="0" step="100">
                </div>

                <div class="input-group">
                    <label for="dividend-income">Dividend Income ($)</label>
                    <input type="number" id="dividend-income" value="1000" min="0" step="100">
                </div>

                <div class="input-group">
                    <label for="business-income">Business Income ($)</label>
                    <input type="number" id="business-income" value="0" min="0" step="1000">
                </div>

                <div class="input-group">
                    <label for="capital-gains">Capital Gains ($)</label>
                    <input type="number" id="capital-gains" value="0" min="0" step="1000">
                </div>

                <div class="input-group">
                    <label for="other-income">Other Income ($)</label>
                    <input type="number" id="other-income" value="0" min="0" step="1000">
                </div>

                <div class="section-title" style="margin-top: 30px;">
                    <i class="fas fa-receipt"></i>
                    <h2>Deductions & Credits</h2>
                </div>

                <div class="input-group">
                    <label for="deduction-method">Deduction Method</label>
                    <div class="toggle-container">
                        <div class="toggle-option active" id="standard-deduction" onclick="toggleDeductionMethod('standard')">Standard</div>
                        <div class="toggle-option" id="itemized-deduction" onclick="toggleDeductionMethod('itemized')">Itemized</div>
                    </div>
                </div>

                <div id="standard-deduction-container">
                    <div class="deduction-section">
                        <h4>Standard Deduction Applied</h4>
                        <p>Based on your filing status, the standard deduction will be automatically applied.</p>
                    </div>
                </div>

                <div id="itemized-deduction-container" style="display: none;">
                    <div class="input-group">
                        <label for="state-local-taxes">State & Local Taxes ($)</label>
                        <input type="number" id="state-local-taxes" value="5000" min="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="mortgage-interest">Mortgage Interest ($)</label>
                        <input type="number" id="mortgage-interest" value="8000" min="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="charitable-contributions">Charitable Contributions ($)</label>
                        <input type="number" id="charitable-contributions" value="2000" min="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="medical-expenses">Medical Expenses ($)</label>
                        <input type="number" id="medical-expenses" value="0" min="0" step="100">
                    </div>

                    <div class="input-group">
                        <label for="other-deductions">Other Deductions ($)</label>
                        <input type="number" id="other-deductions" value="0" min="0" step="100">
                    </div>
                </div>

                <div class="input-group">
                    <label for="retirement-contributions">Retirement Contributions ($)</label>
                    <input type="number" id="retirement-contributions" value="6000" min="0" step="100">
                </div>

                <div class="input-group">
                    <label for="child-tax-credit">Number of Children for Tax Credit</label>
                    <input type="number" id="child-tax-credit" value="0" min="0" max="10">
                </div>

                <div class="input-group">
                    <label for="other-credits">Other Tax Credits ($)</label>
                    <input type="number" id="other-credits" value="0" min="0" step="100">
                </div>

                <div class="input-group">
                    <label for="withholding">Tax Withholding/Prepayments ($)</label>
                    <input type="number" id="withholding" value="10000" min="0" step="100">
                </div>

                <button class="calculate-btn" onclick="calculateTax()">
                    <i class="fas fa-calculator"></i> Calculate Tax Liability
                </button>

                <div class="comparison-section">
                    <h3>Compare Filing Status</h3>
                    <div class="input-group">
                        <label for="compare-status">Compare With</label>
                        <select id="compare-status">
                            <option value="single">Single</option>
                            <option value="married_joint" selected>Married Filing Jointly</option>
                            <option value="married_separate">Married Filing Separately</option>
                            <option value="head_household">Head of Household</option>
                        </select>
                    </div>
                    <button class="calculate-btn" onclick="compareFilingStatus()" style="margin-top: 10px; background: #2ecc71;">
                        Compare Filing Status
                    </button>
                </div>
            </div>

            <div class="results-section">
                <div class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    <h2>Your Tax Summary</h2>
                </div>
                
                <div class="tax-summary">
                    <h3>Estimated Tax Liability</h3>
                    <div class="tax-amount" id="tax-liability">$9,500</div>
                    <div class="tax-description" id="tax-description">Based on 2024 tax brackets</div>
                </div>

                <div id="refund-alert" class="refund-alert" style="display: none;">
                    <h4><i class="fas fa-check-circle"></i> Estimated Tax Refund</h4>
                    <p>Based on your withholding, you may be eligible for a refund of approximately <strong id="refund-amount">$500</strong>.</p>
                </div>

                <div id="payment-alert" class="payment-alert" style="display: none;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Additional Payment Required</h4>
                    <p>Based on your withholding, you may owe an additional <strong id="payment-amount">$500</strong> when filing your return.</p>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <h3>Effective Tax Rate</h3>
                        <div class="value" id="effective-rate">12.7%</div>
                    </div>
                    <div class="result-card">
                        <h3>Marginal Tax Rate</h3>
                        <div class="value" id="marginal-rate">22%</div>
                    </div>
                    <div class="result-card">
                        <h3>Taxable Income</h3>
                        <div class="value" id="taxable-income">$62,500</div>
                    </div>
                    <div class="result-card">
                        <h3>After-Tax Income</h3>
                        <div class="value" id="after-tax-income">$65,500</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="taxBreakdownChart"></canvas>
                </div>

                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('brackets')">Tax Brackets</div>
                        <div class="tab" onclick="switchTab('withholding')">Withholding Analysis</div>
                        <div class="tab" onclick="switchTab('comparison')">Filing Comparison</div>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane active" id="brackets-tab">
                            <div class="bracket-section">
                                <h3>Your Tax Brackets</h3>
                                <div id="tax-brackets-container">
                                    <!-- Tax brackets will be populated here -->
                                </div>
                                <div class="bracket-chart">
                                    <canvas id="bracketChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="withholding-tab">
                            <div class="withholding-section">
                                <h3>Withholding Analysis</h3>
                                <div class="chart-container">
                                    <canvas id="withholdingChart"></canvas>
                                </div>
                                <table class="breakdown-table">
                                    <thead>
                                        <tr>
                                            <th>Component</th>
                                            <th>Amount</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Total Tax Liability</td>
                                            <td id="total-tax-liability">$9,500</td>
                                            <td>100%</td>
                                        </tr>
                                        <tr>
                                            <td>Withholding/Prepayments</td>
                                            <td id="withholding-amount">$10,000</td>
                                            <td id="withholding-percent">105.3%</td>
                                        </tr>
                                        <tr style="font-weight: 600;">
                                            <td>Refund Due</td>
                                            <td id="refund-total">$500</td>
                                            <td id="refund-percent">5.3%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane" id="comparison-tab">
                            <div class="comparison-section">
                                <h3>Filing Status Comparison</h3>
                                <div class="comparison-chart">
                                    <canvas id="comparisonChart"></canvas>
                                </div>
                                <table class="breakdown-table">
                                    <thead>
                                        <tr>
                                            <th>Filing Status</th>
                                            <th>Tax Liability</th>
                                            <th>Difference</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td id="current-status">Single</td>
                                            <td id="current-tax">$9,500</td>
                                            <td>Base Scenario</td>
                                        </tr>
                                        <tr>
                                            <td id="compare-status-display">Married Filing Jointly</td>
                                            <td id="compare-tax">$8,200</td>
                                            <td id="tax-difference">-$1,300</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="insights-section">
                    <h3><i class="fas fa-lightbulb"></i> Tax Optimization Tips</h3>
                    <div class="insight-item">
                        <strong>Maximize Retirement Contributions:</strong> Contributing to traditional IRAs or 401(k)s can reduce your taxable income.
                    </div>
                    <div class="insight-item">
                        <strong>Harvest Tax Losses:</strong> Consider selling investments at a loss to offset capital gains.
                    </div>
                    <div class="insight-item">
                        <strong>Charitable Giving:</strong> Bunch charitable donations in high-income years to maximize deductions.
                    </div>
                    <div class="insight-item">
                        <strong>Health Savings Accounts:</strong> HSAs offer triple tax advantages for qualified medical expenses.
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="print-btn" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Results
                    </button>
                    <button class="reset-btn" onclick="resetCalculator()">
                        <i class="fas fa-redo"></i> Reset Calculator
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let taxBreakdownChart, bracketChart, withholdingChart, comparisonChart;
        let deductionMethod = 'standard';

        // Tax brackets for 2024 (example rates - update with actual IRS data)
        const taxBrackets = {
            single: [
                { min: 0, max: 11600, rate: 0.10 },
                { min: 11601, max: 47150, rate: 0.12 },
                { min: 47151, max: 100525, rate: 0.22 },
                { min: 100526, max: 191950, rate: 0.24 },
                { min: 191951, max: 243725, rate: 0.32 },
                { min: 243726, max: 609350, rate: 0.35 },
                { min: 609351, max: Infinity, rate: 0.37 }
            ],
            married_joint: [
                { min: 0, max: 23200, rate: 0.10 },
                { min: 23201, max: 94300, rate: 0.12 },
                { min: 94301, max: 201050, rate: 0.22 },
                { min: 201051, max: 383900, rate: 0.24 },
                { min: 383901, max: 487450, rate: 0.32 },
                { min: 487451, max: 731200, rate: 0.35 },
                { min: 731201, max: Infinity, rate: 0.37 }
            ],
            married_separate: [
                { min: 0, max: 11600, rate: 0.10 },
                { min: 11601, max: 47150, rate: 0.12 },
                { min: 47151, max: 100525, rate: 0.22 },
                { min: 100526, max: 191950, rate: 0.24 },
                { min: 191951, max: 243725, rate: 0.32 },
                { min: 243726, max: 365600, rate: 0.35 },
                { min: 365601, max: Infinity, rate: 0.37 }
            ],
            head_household: [
                { min: 0, max: 16550, rate: 0.10 },
                { min: 16551, max: 63100, rate: 0.12 },
                { min: 63101, max: 100500, rate: 0.22 },
                { min: 100501, max: 191950, rate: 0.24 },
                { min: 191951, max: 243700, rate: 0.32 },
                { min: 243701, max: 609350, rate: 0.35 },
                { min: 609351, max: Infinity, rate: 0.37 }
            ]
        };

        // Standard deductions for 2024
        const standardDeductions = {
            single: 14600,
            married_joint: 29200,
            married_separate: 14600,
            head_household: 21900
        };

        // Toggle between standard and itemized deductions
        function toggleDeductionMethod(method) {
            deductionMethod = method;
            const standardOption = document.getElementById('standard-deduction');
            const itemizedOption = document.getElementById('itemized-deduction');
            const standardContainer = document.getElementById('standard-deduction-container');
            const itemizedContainer = document.getElementById('itemized-deduction-container');
            
            if (method === 'standard') {
                standardOption.classList.add('active');
                itemizedOption.classList.remove('active');
                standardContainer.style.display = 'block';
                itemizedContainer.style.display = 'none';
            } else {
                standardOption.classList.remove('active');
                itemizedOption.classList.add('active');
                standardContainer.style.display = 'none';
                itemizedContainer.style.display = 'block';
            }
            calculateTax();
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Update tab active states
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content visibility
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(${tabName}-tab).classList.add('active');
        }

        // Calculate tax liability
        function calculateTax() {
            // Get input values
            const filingStatus = document.getElementById('filing-status').value;
            const wages = parseFloat(document.getElementById('wages').value) || 0;
            const interestIncome = parseFloat(document.getElementById('interest-income').value) || 0;
            const dividendIncome = parseFloat(document.getElementById('dividend-income').value) || 0;
            const businessIncome = parseFloat(document.getElementById('business-income').value) || 0;
            const capitalGains = parseFloat(document.getElementById('capital-gains').value) || 0;
            const otherIncome = parseFloat(document.getElementById('other-income').value) || 0;
            const retirementContributions = parseFloat(document.getElementById('retirement-contributions').value) || 0;
            const childTaxCredit = parseInt(document.getElementById('child-tax-credit').value) || 0;
            const otherCredits = parseFloat(document.getElementById('other-credits').value) || 0;
            const withholding = parseFloat(document.getElementById('withholding').value) || 0;

            // Calculate total income
            const totalIncome = wages + interestIncome + dividendIncome + businessIncome + capitalGains + otherIncome;

            // Calculate adjusted gross income (AGI)
            const agi = totalIncome - retirementContributions;

            // Calculate deductions
            let deductions = 0;
            if (deductionMethod === 'standard') {
                deductions = standardDeductions[filingStatus];
            } else {
                const stateLocalTaxes = parseFloat(document.getElementById('state-local-taxes').value) || 0;
                const mortgageInterest = parseFloat(document.getElementById('mortgage-interest').value) || 0;
                const charitableContributions = parseFloat(document.getElementById('charitable-contributions').value) || 0;
                const medicalExpenses = parseFloat(document.getElementById('medical-expenses').value) || 0;
                const otherDeductions = parseFloat(document.getElementById('other-deductions').value) || 0;
                
                // Medical expenses are deductible only to the extent they exceed 7.5% of AGI
                const medicalDeduction = Math.max(0, medicalExpenses - (agi * 0.075));
                
                // State and local taxes are limited to $10,000
                const saltDeduction = Math.min(stateLocalTaxes, 10000);
                
                deductions = saltDeduction + mortgageInterest + charitableContributions + medicalDeduction + otherDeductions;
                
                // Ensure deductions don't exceed the standard deduction
                if (deductions < standardDeductions[filingStatus]) {
                    deductions = standardDeductions[filingStatus];
                    document.getElementById('itemized-deduction-container').style.display = 'none';
                    document.getElementById('standard-deduction-container').style.display = 'block';
                    document.getElementById('standard-deduction').classList.add('active');
                    document.getElementById('itemized-deduction').classList.remove('active');
                    deductionMethod = 'standard';
                }
            }

            // Calculate taxable income
            const taxableIncome = Math.max(0, agi - deductions);

            // Calculate tax using tax brackets
            const brackets = taxBrackets[filingStatus];
            let tax = 0;
            let remainingIncome = taxableIncome;
            let marginalRate = 0;

            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                if (remainingIncome <= 0) break;

                const bracketWidth = bracket.max - bracket.min + 1;
                const incomeInBracket = Math.min(remainingIncome, bracketWidth);
                
                tax += incomeInBracket * bracket.rate;
                remainingIncome -= incomeInBracket;
                
                if (incomeInBracket > 0) {
                    marginalRate = bracket.rate;
                }
            }

            // Apply tax credits
            const childCredit = childTaxCredit * 2000; // $2,000 per child (simplified)
            const totalCredits = childCredit + otherCredits;
            
            // Credits can reduce tax liability but not below zero
            tax = Math.max(0, tax - totalCredits);

            // Calculate effective tax rate
            const effectiveRate = totalIncome > 0 ? (tax / totalIncome) * 100 : 0;

            // Calculate after-tax income
            const afterTaxIncome = totalIncome - tax;

            // Calculate refund or amount due
            const refundOrDue = withholding - tax;

            // Update results
            document.getElementById('tax-liability').textContent = $${Math.round(tax).toLocaleString()};
            document.getElementById('tax-description').textContent = Based on ${document.getElementById('tax-year').value} tax brackets;
            document.getElementById('effective-rate').textContent = ${effectiveRate.toFixed(1)}%;
            document.getElementById('marginal-rate').textContent = ${(marginalRate * 100).toFixed(0)}%;
            document.getElementById('taxable-income').textContent = $${Math.round(taxableIncome).toLocaleString()};
            document.getElementById('after-tax-income').textContent = $${Math.round(afterTaxIncome).toLocaleString()};

            // Update refund/payment alerts
            const refundAlert = document.getElementById('refund-alert');
            const paymentAlert = document.getElementById('payment-alert');
            
            if (refundOrDue > 0) {
                refundAlert.style.display = 'block';
                paymentAlert.style.display = 'none';
                document.getElementById('refund-amount').textContent = $${Math.round(refundOrDue).toLocaleString()};
            } else if (refundOrDue < 0) {
                refundAlert.style.display = 'none';
                paymentAlert.style.display = 'block';
                document.getElementById('payment-amount').textContent = $${Math.round(-refundOrDue).toLocaleString()};
            } else {
                refundAlert.style.display = 'none';
                paymentAlert.style.display = 'none';
            }

            // Update withholding analysis
            document.getElementById('total-tax-liability').textContent = $${Math.round(tax).toLocaleString()};
            document.getElementById('withholding-amount').textContent = $${Math.round(withholding).toLocaleString()};
            document.getElementById('withholding-percent').textContent = ${((withholding / tax) * 100).toFixed(1)}%;
            document.getElementById('refund-total').textContent = $${Math.round(Math.max(0, refundOrDue)).toLocaleString()};
            document.getElementById('refund-percent').textContent = ${((Math.max(0, refundOrDue) / tax) * 100).toFixed(1)}%;

            // Update charts
            updateTaxBreakdownChart(wages, interestIncome, dividendIncome, businessIncome, capitalGains, otherIncome, tax, deductions, totalCredits);
            updateBracketChart(filingStatus, taxableIncome);
            updateWithholdingChart(tax, withholding, Math.max(0, refundOrDue));
        }

        // Compare different filing statuses
        function compareFilingStatus() {
            const currentStatus = document.getElementById('filing-status').value;
            const compareStatus = document.getElementById('compare-status').value;
            
            // Get current tax liability
            const currentTaxElement = document.getElementById('tax-liability');
            const currentTax = parseFloat(currentTaxElement.textContent.replace(/[$,]/g, ''));
            
            // Calculate tax for comparison status
            const wages = parseFloat(document.getElementById('wages').value) || 0;
            const interestIncome = parseFloat(document.getElementById('interest-income').value) || 0;
            const dividendIncome = parseFloat(document.getElementById('dividend-income').value) || 0;
            const businessIncome = parseFloat(document.getElementById('business-income').value) || 0;
            const capitalGains = parseFloat(document.getElementById('capital-gains').value) || 0;
            const otherIncome = parseFloat(document.getElementById('other-income').value) || 0;
            const retirementContributions = parseFloat(document.getElementById('retirement-contributions').value) || 0;
            
            const totalIncome = wages + interestIncome + dividendIncome + businessIncome + capitalGains + otherIncome;
            const agi = totalIncome - retirementContributions;
            
            // Use standard deduction for comparison
            const deductions = standardDeductions[compareStatus];
            const taxableIncome = Math.max(0, agi - deductions);
            
            // Calculate tax for comparison status
            const brackets = taxBrackets[compareStatus];
            let compareTax = 0;
            let remainingIncome = taxableIncome;

            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                if (remainingIncome <= 0) break;

                const bracketWidth = bracket.max - bracket.min + 1;
                const incomeInBracket = Math.min(remainingIncome, bracketWidth);
                
                compareTax += incomeInBracket * bracket.rate;
                remainingIncome -= incomeInBracket;
            }
            
            // Update comparison table
            document.getElementById('current-status').textContent = formatFilingStatus(currentStatus);
            document.getElementById('current-tax').textContent = $${Math.round(currentTax).toLocaleString()};
            document.getElementById('compare-status-display').textContent = formatFilingStatus(compareStatus);
            document.getElementById('compare-tax').textContent = $${Math.round(compareTax).toLocaleString()};
            const difference = compareTax - currentTax;
            document.getElementById('tax-difference').textContent = ${difference >= 0 ? '+' : ''}$${Math.round(difference).toLocaleString()};
            
            // Update comparison chart
            updateComparisonChart(currentStatus, compareStatus, currentTax, compareTax);
        }

        // Format filing status for display
        function formatFilingStatus(status) {
            switch(status) {
                case 'single': return 'Single';
                case 'married_joint': return 'Married Filing Jointly';
                case 'married_separate': return 'Married Filing Separately';
                case 'head_household': return 'Head of Household';
                default: return status;
            }
        }

        // Update the tax breakdown chart
        function updateTaxBreakdownChart(wages, interest, dividends, business, capitalGains, other, tax, deductions, credits) {
            const ctx = document.getElementById('taxBreakdownChart').getContext('2d');
            
            if (taxBreakdownChart) {
                taxBreakdownChart.destroy();
            }
            
            const totalIncome = wages + interest + dividends + business + capitalGains + other;
            const afterTaxIncome = totalIncome - tax;
            
            taxBreakdownChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Wages & Salary', 'Interest Income', 'Dividend Income', 'Business Income', 'Capital Gains', 'Other Income', 'Tax Paid', 'Deductions & Credits'],
                    datasets: [{
                        data: [wages, interest, dividends, business, capitalGains, other, tax, deductions + credits],
                        backgroundColor: [
                            '#2d3436',
                            '#636e72',
                            '#b2bec3',
                            '#dfe6e9',
                            '#74b9ff',
                            '#0984e3',
                            '#d63031',
                            '#00b894'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ${context.label}: $${context.raw.toLocaleString()};
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update the tax bracket chart
        function updateBracketChart(filingStatus, taxableIncome) {
            const ctx = document.getElementById('bracketChart').getContext('2d');
            
            if (bracketChart) {
                bracketChart.destroy();
            }
            
            const brackets = taxBrackets[filingStatus];
            const bracketData = [];
            const bracketLabels = [];
            const bracketColors = [];
            
            let remainingIncome = taxableIncome;
            
            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                if (remainingIncome <= 0) break;
                
                const bracketWidth = bracket.max - bracket.min + 1;
                const incomeInBracket = Math.min(remainingIncome, bracketWidth);
                
                bracketData.push(incomeInBracket);
                bracketLabels.push(${(bracket.rate * 100).toFixed(0)}% Bracket);
                bracketColors.push(getBracketColor(bracket.rate));
                
                remainingIncome -= incomeInBracket;
            }
            
            // Update the tax brackets visualization
            const bracketsContainer = document.getElementById('tax-brackets-container');
            bracketsContainer.innerHTML = '';
            
            let currentIncome = 0;
            for (let i = 0; i < brackets.length; i++) {
                const bracket = brackets[i];
                const bracketWidth = bracket.max - bracket.min + 1;
                const incomeInBracket = Math.min(taxableIncome - currentIncome, bracketWidth);
                const percentage = taxableIncome > 0 ? (incomeInBracket / taxableIncome) * 100 : 0;
                
                if (incomeInBracket > 0) {
                    const bracketElement = document.createElement('div');
                    bracketElement.className = 'tax-bracket';
                    bracketElement.innerHTML = `
                        <div class="bracket-range">$${bracket.min.toLocaleString()} - $${bracket.max === Infinity ? 'âˆž' : bracket.max.toLocaleString()}</div>
                        <div class="bracket-bar">
                            <div class="bracket-fill" style="width: ${percentage}%; background: ${getBracketColor(bracket.rate)};"></div>
                        </div>
                        <div class="bracket-rate">${(bracket.rate * 100).toFixed(0)}%</div>
                    `;
                    bracketsContainer.appendChild(bracketElement);
                }
                
                currentIncome += bracketWidth;
                if (currentIncome >= taxableIncome) break;
            }
            
            bracketChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bracketLabels,
                    datasets: [{
                        label: 'Taxable Income by Bracket',
                        data: bracketData,
                        backgroundColor: bracketColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Income Distribution Across Tax Brackets'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount ($)'
                            }
                        }
                    }
                }
            });
        }

        // Get color for tax bracket
        function getBracketColor(rate) {
            if (rate <= 0.12) return '#2ecc71';
            if (rate <= 0.22) return '#3498db';
            if (rate <= 0.24) return '#f39c12';
            if (rate <= 0.32) return '#e67e22';
            if (rate <= 0.35) return '#e74c3c';
            return '#c0392b';
        }

        // Update the withholding chart
        function updateWithholdingChart(tax, withholding, refund) {
            const ctx = document.getElementById('withholdingChart').getContext('2d');
            
            if (withholdingChart) {
                withholdingChart.destroy();
            }
            
            const amountDue = Math.max(0, tax - withholding);
            
            withholdingChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tax Liability', 'Withholding', 'Refund'],
                    datasets: [{
                        data: [tax, withholding, refund],
                        backgroundColor: [
                            '#2d3436',
                            '#3498db',
                            '#2ecc71'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ${context.label}: $${context.raw.toLocaleString()};
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update the comparison chart
        function updateComparisonChart(currentStatus, compareStatus, currentTax, compareTax) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [formatFilingStatus(currentStatus), formatFilingStatus(compareStatus)],
                    datasets: [{
                        label: 'Tax Liability',
                        data: [currentTax, compareTax],
                        backgroundColor: ['#2d3436', '#3498db'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tax Liability by Filing Status'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tax Amount ($)'
                            }
                        }
                    }
                }
            });
        }

        // Reset the calculator
        function resetCalculator() {
            document.getElementById('filing-status').value = 'single';
            document.getElementById('tax-year').value = '2024';
            document.getElementById('age').value = '35';
            document.getElementById('wages').value = '75000';
            document.getElementById('interest-income').value = '500';
            document.getElementById('dividend-income').value = '1000';
            document.getElementById('business-income').value = '0';
            document.getElementById('capital-gains').value = '0';
            document.getElementById('other-income').value = '0';
            document.getElementById('retirement-contributions').value = '6000';
            document.getElementById('child-tax-credit').value = '0';
            document.getElementById('other-credits').value = '0';
            document.getElementById('withholding').value = '10000';
            document.getElementById('compare-status').value = 'married_joint';
            
            toggleDeductionMethod('standard');
            calculateTax();
        }

        // Initialize the calculator
        window.onload = function() {
            calculateTax();
        };
    </script>
</body>
</html>